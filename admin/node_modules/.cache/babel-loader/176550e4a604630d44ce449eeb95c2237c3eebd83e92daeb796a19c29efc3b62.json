{"ast":null,"code":"import axios from 'axios';\nimport { toast } from 'react-toastify';\n\n// Configure axios base URL\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000';\nconst IS_DEVELOPMENT = process.env.REACT_APP_ENVIRONMENT === 'development' || process.env.NODE_ENV === 'development';\n// Alternate dev base URLs to try if the primary is unreachable (no server restart needed)\nconst DEV_ALT_BASES = ['http://localhost:5000', 'http://localhost:5001', 'http://localhost:5003'];\nconst getAlternateBase = current => {\n  if (!IS_DEVELOPMENT) return null;\n  const idx = DEV_ALT_BASES.indexOf(current);\n  if (idx === -1) return DEV_ALT_BASES[0];\n  return DEV_ALT_BASES[(idx + 1) % DEV_ALT_BASES.length];\n};\nconsole.log('Admin Panel API Base URL:', API_BASE_URL);\nconsole.log('Environment:', IS_DEVELOPMENT ? 'development' : 'production');\naxios.defaults.baseURL = API_BASE_URL;\n\n// Add request timeout\naxios.defaults.timeout = IS_DEVELOPMENT ? 10000 : 30000; // Shorter timeout for development\n\n// Configure CORS based on environment\nif (IS_DEVELOPMENT) {\n  // For development, don't use withCredentials to avoid CORS issues\n  axios.defaults.withCredentials = false;\n} else {\n  // For production, use withCredentials for proper CORS\n  axios.defaults.withCredentials = true;\n}\n\n// Request interceptor\naxios.interceptors.request.use(config => {\n  // Add timestamp to prevent caching issues\n  config.params = {\n    ...config.params,\n    _t: Date.now()\n  };\n\n  // Ensure proper headers\n  config.headers = {\n    'Content-Type': 'application/json',\n    'Accept': 'application/json',\n    ...config.headers\n  };\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Response interceptor with retry logic\naxios.interceptors.response.use(response => {\n  return response;\n}, async error => {\n  var _error$message, _error$message2, _error$response, _error$response2;\n  const originalRequest = error.config;\n\n  // Handle ERR_ABORTED and network errors with retry\n  if ((error.code === 'ERR_ABORTED' || error.code === 'ERR_NETWORK' || (_error$message = error.message) !== null && _error$message !== void 0 && _error$message.includes('aborted') || (_error$message2 = error.message) !== null && _error$message2 !== void 0 && _error$message2.includes('Network Error')) && !originalRequest._retry && originalRequest._retryCount < 3) {\n    originalRequest._retry = true;\n    originalRequest._retryCount = (originalRequest._retryCount || 0) + 1;\n    console.log(`Retrying request (attempt ${originalRequest._retryCount}/3):`, originalRequest.url);\n\n    // Wait before retry (exponential backoff)\n    const delay = Math.pow(2, originalRequest._retryCount) * 1000;\n    await new Promise(resolve => setTimeout(resolve, delay));\n\n    // Retry the request\n    return axios(originalRequest);\n  }\n\n  // Handle 401 errors (unauthorized)\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n    var _originalRequest$url;\n    // Don't show toast for login endpoint\n    if (!((_originalRequest$url = originalRequest.url) !== null && _originalRequest$url !== void 0 && _originalRequest$url.includes('/login'))) {\n      toast.error('Session expired. Please login again.');\n      // Clear auth data\n      localStorage.removeItem('adminToken');\n      localStorage.removeItem('adminData');\n      delete axios.defaults.headers.common['Authorization'];\n      // Redirect to login\n      window.location.href = '/login';\n    }\n  }\n\n  // Handle other errors\n  if (((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status) >= 500) {\n    toast.error('Server error. Please try again later.');\n  } else if (error.code === 'ERR_ABORTED') {\n    toast.error('Request was aborted. Please check your connection and try again.');\n  } else if (error.code === 'ERR_NETWORK') {\n    // In development, attempt an automatic base URL fallback (e.g., 5001 -> 5003)\n    if (IS_DEVELOPMENT && originalRequest && !originalRequest._triedAltBase && /^http:\\/\\/localhost:\\d+/.test(axios.defaults.baseURL || '')) {\n      const currentBase = axios.defaults.baseURL;\n      const altBase = getAlternateBase(currentBase);\n      if (altBase && altBase !== currentBase) {\n        console.log(`API base unreachable at ${currentBase}. Trying alternate base ${altBase} for this request.`);\n        // Mark to avoid loops\n        originalRequest._triedAltBase = true;\n        // Use the alternate base only for this retry\n        const reqForAlt = {\n          ...originalRequest,\n          baseURL: altBase\n        };\n        try {\n          const altResp = await axios(reqForAlt);\n          // If alternate succeeds, switch global base for subsequent requests\n          axios.defaults.baseURL = altBase;\n          console.log(`Switched API base URL to ${altBase}`);\n          return altResp;\n        } catch (altErr) {\n          // If alternate also fails, fall through to toast below\n        }\n      }\n    }\n    toast.error('Network error. Please check your internet connection.');\n  }\n  return Promise.reject(error);\n});\nexport default axios;","map":{"version":3,"names":["axios","toast","API_BASE_URL","process","env","REACT_APP_API_URL","IS_DEVELOPMENT","REACT_APP_ENVIRONMENT","NODE_ENV","DEV_ALT_BASES","getAlternateBase","current","idx","indexOf","length","console","log","defaults","baseURL","timeout","withCredentials","interceptors","request","use","config","params","_t","Date","now","headers","error","Promise","reject","response","_error$message","_error$message2","_error$response","_error$response2","originalRequest","code","message","includes","_retry","_retryCount","url","delay","Math","pow","resolve","setTimeout","status","_originalRequest$url","localStorage","removeItem","common","window","location","href","_triedAltBase","test","currentBase","altBase","reqForAlt","altResp","altErr"],"sources":["C:/Users/hp/Desktop/ADMINCLIENTPANELDEMO/perfectclone/admin/src/utils/axiosConfig.js"],"sourcesContent":["import axios from 'axios';\nimport { toast } from 'react-toastify';\n\n// Configure axios base URL\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000';\nconst IS_DEVELOPMENT = process.env.REACT_APP_ENVIRONMENT === 'development' || process.env.NODE_ENV === 'development';\n// Alternate dev base URLs to try if the primary is unreachable (no server restart needed)\nconst DEV_ALT_BASES = ['http://localhost:5000', 'http://localhost:5001', 'http://localhost:5003'];\nconst getAlternateBase = (current) => {\n  if (!IS_DEVELOPMENT) return null;\n  const idx = DEV_ALT_BASES.indexOf(current);\n  if (idx === -1) return DEV_ALT_BASES[0];\n  return DEV_ALT_BASES[(idx + 1) % DEV_ALT_BASES.length];\n};\n\nconsole.log('Admin Panel API Base URL:', API_BASE_URL);\nconsole.log('Environment:', IS_DEVELOPMENT ? 'development' : 'production');\n\naxios.defaults.baseURL = API_BASE_URL;\n\n// Add request timeout\naxios.defaults.timeout = IS_DEVELOPMENT ? 10000 : 30000; // Shorter timeout for development\n\n// Configure CORS based on environment\nif (IS_DEVELOPMENT) {\n  // For development, don't use withCredentials to avoid CORS issues\n  axios.defaults.withCredentials = false;\n} else {\n  // For production, use withCredentials for proper CORS\n  axios.defaults.withCredentials = true;\n}\n\n// Request interceptor\naxios.interceptors.request.use(\n  (config) => {\n    // Add timestamp to prevent caching issues\n    config.params = {\n      ...config.params,\n      _t: Date.now()\n    };\n    \n    // Ensure proper headers\n    config.headers = {\n      'Content-Type': 'application/json',\n      'Accept': 'application/json',\n      ...config.headers\n    };\n    \n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Response interceptor with retry logic\naxios.interceptors.response.use(\n  (response) => {\n    return response;\n  },\n  async (error) => {\n    const originalRequest = error.config;\n    \n    // Handle ERR_ABORTED and network errors with retry\n    if (\n      (error.code === 'ERR_ABORTED' || \n       error.code === 'ERR_NETWORK' ||\n       error.message?.includes('aborted') ||\n       error.message?.includes('Network Error')) &&\n      !originalRequest._retry &&\n      originalRequest._retryCount < 3\n    ) {\n      originalRequest._retry = true;\n      originalRequest._retryCount = (originalRequest._retryCount || 0) + 1;\n      \n      console.log(`Retrying request (attempt ${originalRequest._retryCount}/3):`, originalRequest.url);\n      \n      // Wait before retry (exponential backoff)\n      const delay = Math.pow(2, originalRequest._retryCount) * 1000;\n      await new Promise(resolve => setTimeout(resolve, delay));\n      \n      // Retry the request\n      return axios(originalRequest);\n    }\n    \n    // Handle 401 errors (unauthorized)\n    if (error.response?.status === 401) {\n      // Don't show toast for login endpoint\n      if (!originalRequest.url?.includes('/login')) {\n        toast.error('Session expired. Please login again.');\n        // Clear auth data\n        localStorage.removeItem('adminToken');\n        localStorage.removeItem('adminData');\n        delete axios.defaults.headers.common['Authorization'];\n        // Redirect to login\n        window.location.href = '/login';\n      }\n    }\n    \n    // Handle other errors\n    if (error.response?.status >= 500) {\n      toast.error('Server error. Please try again later.');\n    } else if (error.code === 'ERR_ABORTED') {\n      toast.error('Request was aborted. Please check your connection and try again.');\n    } else if (error.code === 'ERR_NETWORK') {\n      // In development, attempt an automatic base URL fallback (e.g., 5001 -> 5003)\n      if (IS_DEVELOPMENT && originalRequest && !originalRequest._triedAltBase && /^http:\\/\\/localhost:\\d+/.test(axios.defaults.baseURL || '')) {\n        const currentBase = axios.defaults.baseURL;\n        const altBase = getAlternateBase(currentBase);\n        if (altBase && altBase !== currentBase) {\n          console.log(`API base unreachable at ${currentBase}. Trying alternate base ${altBase} for this request.`);\n          // Mark to avoid loops\n          originalRequest._triedAltBase = true;\n          // Use the alternate base only for this retry\n          const reqForAlt = { ...originalRequest, baseURL: altBase };\n          try {\n            const altResp = await axios(reqForAlt);\n            // If alternate succeeds, switch global base for subsequent requests\n            axios.defaults.baseURL = altBase;\n            console.log(`Switched API base URL to ${altBase}`);\n            return altResp;\n          } catch (altErr) {\n            // If alternate also fails, fall through to toast below\n          }\n        }\n      }\n      toast.error('Network error. Please check your internet connection.');\n    }\n    \n    return Promise.reject(error);\n  }\n);\n\nexport default axios;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}